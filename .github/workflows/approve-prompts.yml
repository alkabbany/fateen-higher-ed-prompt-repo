name: Approve and Move Prompts

on:
  issue_comment:
    types: [created]

jobs:
  approve_prompt:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Check for Approval
      if: github.event.comment.body == 'Approved'
      run: |
        PROMPT_TITLE=$(awk '/^### / {print $2; exit}' prompts/pending-approval.md)
        DEPARTMENT=$(awk '/\*\*Use Case\*\*: / {print $3; exit}' prompts/pending-approval.md)
        
        if [[ "$DEPARTMENT" == "Architectural Engineering" ]]; then
          TARGET_FILE="prompts/engineering-architectural.md"
        elif [[ "$DEPARTMENT" == "Computer Engineering" ]]; then
          TARGET_FILE="prompts/engineering-computer.md"
        elif [[ "$DEPARTMENT" == "Chemical and Petrochemical Engineering" ]]; then
          TARGET_FILE="prompts/engineering-chemical.md"
        elif [[ "$DEPARTMENT" == "Construction and Building Engineering" ]]; then
          TARGET_FILE="prompts/engineering-construction.md"
        elif [[ "$DEPARTMENT" == "Electronics and Communications Engineering" ]]; then
          TARGET_FILE="prompts/engineering-electronics.md"
        elif [[ "$DEPARTMENT" == "Electrical and Control Engineering" ]]; then
          TARGET_FILE="prompts/engineering-electrical.md"
        elif [[ "$DEPARTMENT" == "Industrial and Management Engineering" ]]; then
          TARGET_FILE="prompts/engineering-industrial.md"
        elif [[ "$DEPARTMENT" == "Marine and Offshore Engineering" ]]; then
          TARGET_FILE="prompts/engineering-marine.md"
        elif [[ "$DEPARTMENT" == "Mechanical Engineering" ]]; then
          TARGET_FILE="prompts/engineering-mechanical.md"
        elif [[ "$DEPARTMENT" == "Oil and Gas Engineering" ]]; then
          TARGET_FILE="prompts/engineering-oil.md"
        else
          TARGET_FILE="prompts/general.md"
        fi

        grep -v "$PROMPT_TITLE" prompts/pending-approval.md > temp.md && mv temp.md prompts/pending-approval.md
        echo "### $PROMPT_TITLE" >> $TARGET_FILE
        git config --global user.name 'github-actions'
        git config --global user.email 'actions@github.com'
        git add prompts/*
        git commit -m "Approved prompt $PROMPT_TITLE moved to $TARGET_FILE"
        git push
